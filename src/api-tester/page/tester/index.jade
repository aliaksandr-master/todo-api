extends ../../inc/templates/layout-empty
mixin pre-panel(name, text)
	.panel.panel-default(id='api-tester-' + name)
		.panel-heading!= text
		pre.panel-body

mixin run-panel(name, text)
	.panel.panel-default(id='api-tester-' + name)
		.panel-heading.clearfix
			span.pull-left!= text
		.panel-body
			.panel-body-content
			.input-group
				.input-group-btn
					button.run-panel-add-button.btn.btn-default.btn-sm(type='button') Add
				select.run-panel-add-button.form-control.input-sm
					option(value='string') String
					option(value='text')  Textarea
					option(value='decimal')  Decimal
					option(value='float')  Float
					option(value='boolean')  Boolean
					option(value='integer')  Integer

mixin raw-panel(name, text)
	.panel.panel-default.panel-raw(id='api-tester-' + name)
		.panel-heading.clearfix
			span.pull-left!= text
			label.pull-right.panel-raw-toggle
				input(type='checkbox',value=1)
				b Raw
		pre.panel-body.-transformed
		pre.panel-body.-raw(style='display:none;')

block container
	script
		!= 'window.MY_ROOT = "/api-tester/";'
		!= 'window.API_ROOT = "/api/";'
		!= 'window.API_JSON = ' + JSON.stringify(specsSrc) + ';'
		!= 'window.API_ROUTES_JSON = ' + JSON.stringify(routes) + ';'
	div(style="margin: 15px 15px 0;")
		.row#api-tester

			.col-md-9#api-tester-info

				.api-tester-spec-wr
					h1#api-tester-spec-name
					h2#api-tester-spec-ctrl
					h2#api-tester-spec-action
					div#api-tester-spec-description

				+pre-panel('interaction-info', 'Info')
				+raw-panel('request-data', 'Request Data')
				+raw-panel('response-headers', 'Response Headers')

			.col-md-14#api-tester-response
				#errors

				+raw-panel('response-data', 'Response Data')

			.col-md-7#api-tester-request

				#form-head.clearfix
					.row
						.col-sm-30
							.form-control-wr
								label Route
								select#form-route.input-sm.form-control
					.row
						.col-sm-10
							.form-control-wr
								label Method
								input#form-route-method.input-sm.form-control(type="text",placeholder='http method')
						.col-sm-10
							.form-control-wr
								label Request
								input#form-request-format.input-sm.form-control(type="text", placeholder='request data format', value="json")
						.col-sm-10
							.form-control-wr
								label Resposne
								input#form-response-format.input-sm.form-control(type="text", placeholder='response data format', value="json")

					.row
						.col-sm-30
							.form-control-wr
								label Request Uri
								input#form-route-url.input-sm.form-control(type="text", placeholder='request url')
						.col-sm-30
							.form-control-wr
								input#form-request-query.input-sm.form-control(type="text", placeholder='additional query', value="_debug=debug")

				#api-tester-form-submit-wr.clearfix
					button#api-tester-form-submit.btn.btn-success.pull-left(type="submit") Submit
					button.btn.btn-default.putData.pull-right Invalid
					button.btn.btn-default.putData.pull-right.-valid Valid

				form#api-tester-form
					+run-panel('form-body',  'Request data (Body)')
					+run-panel('form-query', 'Request data (Query)')
					+run-panel('form-params',  'Request data (Url Params)')

block scripts
	script(type="text/x-handlebars-template",data-src="/form/field.hbs")!= read('/static/templates/form/field.hbs')
	script(type="text/x-handlebars-template",data-src="/form/select.hbs")!= read('/static/templates/form/select.hbs')
	script(type="text/x-handlebars-template",data-src="/form/text.hbs")!= read('/static/templates/form/text.hbs')
	script(type="text/x-handlebars-template",data-src="/form/toggle.hbs")!= read('/static/templates/form/toggle.hbs')
	script.
		require(['jquery', 'modules/tester'], function ($, run) {
			$(function () {
				run();
			});
		});
